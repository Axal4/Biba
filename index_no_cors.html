<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moldova - –ò–≥—Ä–∞ –±–µ–∑ CORS</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: 'Arial', sans-serif;
            overflow: hidden;
        }
        
        #game-container {
            width: 100vw;
            height: 100vh;
            position: relative;
        }
        
        .cors-warning {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            background: rgba(255, 193, 7, 0.9);
            color: #856404;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid #ffc107;
            z-index: 1000;
            text-align: center;
            font-weight: bold;
        }
        
        .cors-warning a {
            color: #0056b3;
            text-decoration: none;
            font-weight: bold;
        }
        
        .cors-warning a:hover {
            text-decoration: underline;
        }
        
        .fallback-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: white;
            z-index: 999;
            background: rgba(0, 0, 0, 0.8);
            padding: 40px;
            border-radius: 15px;
            max-width: 600px;
        }
        
        .fallback-content h1 {
            font-size: 2.5em;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        .fallback-content p {
            font-size: 1.2em;
            margin-bottom: 20px;
            line-height: 1.6;
        }
        
        .fallback-content button {
            background: #007bff;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.1em;
            border-radius: 8px;
            cursor: pointer;
            margin: 10px;
            transition: background 0.3s;
        }
        
        .fallback-content button:hover {
            background: #0056b3;
        }
        
        .fallback-content button:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        
        .loading {
            display: none;
            margin: 20px 0;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #007bff;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div id="game-container">
        <!-- –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ CORS -->
        <div class="cors-warning">
            ‚ö†Ô∏è <strong>–ü—Ä–æ–±–ª–µ–º–∞ CORS:</strong> –ò–≥—Ä–∞ –º–æ–∂–µ—Ç –Ω–µ –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –∏–∑-–∑–∞ –ø–æ–ª–∏—Ç–∏–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –±—Ä–∞—É–∑–µ—Ä–∞. 
            <a href="http://localhost:8000" target="_blank">–ó–∞–ø—É—Å—Ç–∏—Ç–µ —á–µ—Ä–µ–∑ –ª–æ–∫–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä</a> –∏–ª–∏ 
            <a href="local_server.html" target="_blank">–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –Ω–∞—à –ø–æ–º–æ—â–Ω–∏–∫</a>.
        </div>
        
        <!-- Fallback –∫–æ–Ω—Ç–µ–Ω—Ç -->
        <div class="fallback-content" id="fallback-content">
            <h1>üéÆ Moldova Game</h1>
            <p>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –∏–≥—Ä—É –æ –ø–æ–ª–∏—Ç–∏—á–µ—Å–∫–æ–π –±–æ—Ä—å–±–µ –≤ –ú–æ–ª–¥–æ–≤–µ!</p>
            <p>–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–æ—Ä–æ–Ω—É –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–≤–æ–µ–≤–∞—Ç—å –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å —Å—Ä–µ–¥–∏ —Ä–µ–≥–∏–æ–Ω–æ–≤.</p>
            
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>–ó–∞–≥—Ä—É–∑–∫–∞ –∏–≥—Ä—ã...</p>
            </div>
            
            <button onclick="tryLoadGame()" id="load-btn">üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å –∏–≥—Ä—É</button>
            <button onclick="showInstructions()">üìñ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏</button>
            <button onclick="openLocalServer()">üåê –õ–æ–∫–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä</button>
        </div>
    </div>

    <script>
        let gameLoaded = false;
        let loadAttempts = 0;
        const maxLoadAttempts = 3;

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –º–æ–∂–µ–º –ª–∏ –º—ã –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–≥—Ä—É
        function tryLoadGame() {
            const loading = document.getElementById('loading');
            const loadBtn = document.getElementById('load-btn');
            
            loading.style.display = 'block';
            loadBtn.disabled = true;
            loadBtn.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞...';
            
            loadAttempts++;
            
            // –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å –æ—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏–≥—Ä—ã
            setTimeout(() => {
                if (loadAttempts >= maxLoadAttempts) {
                    showFallbackMessage();
                    return;
                }
                
                try {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Phaser
                    if (typeof Phaser !== 'undefined') {
                        startGame();
                    } else {
                        // –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å Phaser
                        loadPhaser();
                    }
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–≥—Ä—ã:', error);
                    if (loadAttempts < maxLoadAttempts) {
                        loadBtn.disabled = false;
                        loadBtn.textContent = 'üîÑ –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞';
                        loading.style.display = 'none';
                    } else {
                        showFallbackMessage();
                    }
                }
            }, 2000);
        }

        function loadPhaser() {
            // –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç script –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ Phaser
            const script = document.createElement('script');
            script.src = 'https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.min.js';
            script.onload = () => {
                console.log('Phaser –∑–∞–≥—Ä—É–∂–µ–Ω, –∑–∞–ø—É—Å–∫–∞–µ–º –∏–≥—Ä—É...');
                startGame();
            };
            script.onerror = () => {
                console.error('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å Phaser');
                showFallbackMessage();
            };
            document.head.appendChild(script);
        }

        function startGame() {
            try {
                // –°–∫—Ä—ã–≤–∞–µ–º fallback –∫–æ–Ω—Ç–µ–Ω—Ç
                document.getElementById('fallback-content').style.display = 'none';
                
                // –°–æ–∑–¥–∞–µ–º –ø—Ä–æ—Å—Ç—É—é –∏–≥—Ä—É
                const config = {
                    type: Phaser.AUTO,
                    width: window.innerWidth,
                    height: window.innerHeight,
                    parent: 'game-container',
                    backgroundColor: '#2c3e50',
                    scene: {
                        preload: preload,
                        create: create,
                        update: update
                    },
                    render: {
                        antialias: true,
                        roundPixels: false,
                        powerPreference: 'high-performance'
                    }
                };

                const game = new Phaser.Game(config);
                gameLoaded = true;
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∏–≥—Ä—ã:', error);
                showFallbackMessage();
            }
        }

        function preload() {
            // –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            try {
                this.load.image('moldova_map', 'assets/images/moldova_map.png');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:', error);
            }
        }

        function create() {
            try {
                // –°–æ–∑–¥–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
                this.add.text(400, 100, 'MOLDOVA GAME', {
                    fontSize: '48px',
                    fill: '#ffffff',
                    stroke: '#000000',
                    strokeThickness: 4,
                    shadow: { offsetX: 2, offsetY: 2, color: '#000000', blur: 4 }
                }).setOrigin(0.5);

                // –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–∫–∞–∑–∞—Ç—å –∫–∞—Ä—Ç—É
                try {
                    if (this.textures.exists('moldova_map')) {
                        const map = this.add.image(400, 300, 'moldova_map');
                        map.setScale(0.8);
                        this.add.text(400, 500, '–ö–∞—Ä—Ç–∞ –ú–æ–ª–¥–æ–≤—ã –∑–∞–≥—Ä—É–∂–µ–Ω–∞!', {
                            fontSize: '24px',
                            fill: '#00ff00'
                        }).setOrigin(0.5);
                    } else {
                        this.add.text(400, 300, '–ö–∞—Ä—Ç–∞ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞\n(–ø—Ä–æ–±–ª–µ–º–∞ CORS)', {
                            fontSize: '24px',
                            fill: '#ff0000',
                            align: 'center'
                        }).setOrigin(0.5);
                    }
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–∞—Ä—Ç—ã:', error);
                }

                // –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫–∏
                const startBtn = this.add.text(400, 400, 'üéÆ –ù–∞—á–∞—Ç—å –∏–≥—Ä—É', {
                    fontSize: '32px',
                    fill: '#ffffff',
                    backgroundColor: '#007bff',
                    padding: { x: 20, y: 10 }
                }).setOrigin(0.5).setInteractive();

                startBtn.on('pointerdown', () => {
                    this.add.text(400, 450, '–ò–≥—Ä–∞ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ...', {
                        fontSize: '24px',
                        fill: '#ffff00'
                    }).setOrigin(0.5);
                });

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å—Ü–µ–Ω—ã:', error);
            }
        }

        function update() {
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–≥—Ä—ã
        }

        function showFallbackMessage() {
            const fallback = document.getElementById('fallback-content');
            fallback.innerHTML = `
                <h1>‚ùå –ò–≥—Ä–∞ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–∞—Å—å</h1>
                <p>–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –Ω–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–≥—Ä—É –∏–∑-–∑–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –±—Ä–∞—É–∑–µ—Ä–∞.</p>
                <p><strong>–†–µ—à–µ–Ω–∏–µ:</strong> –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∏–≥—Ä—É —á–µ—Ä–µ–∑ –ª–æ–∫–∞–ª—å–Ω—ã–π –≤–µ–±-—Å–µ—Ä–≤–µ—Ä.</p>
                
                <button onclick="openLocalServer()">üåê –ó–∞–ø—É—Å—Ç–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä</button>
                <button onclick="downloadPython()">üì• –°–∫–∞—á–∞—Ç—å Python</button>
                <button onclick="location.reload()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É</button>
            `;
        }

        function showInstructions() {
            alert(`üéÆ –ò–ù–°–¢–†–£–ö–¶–ò–ò –ü–û –ó–ê–ü–£–°–ö–£:

1. üåê –õ–æ–∫–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):
   - –ó–∞–ø—É—Å—Ç–∏—Ç–µ start_server.bat –∏–ª–∏ start_server.ps1
   - –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:8000

2. üì• –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Python:
   - –°–∫–∞—á–∞–π—Ç–µ —Å python.org
   - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å –≥–∞–ª–æ—á–∫–æ–π "Add to PATH"
   - –ó–∞–ø—É—Å—Ç–∏—Ç–µ start_server.bat

3. üîß VS Code Live Server:
   - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ VS Code
   - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ Live Server
   - –ü—Ä–∞–≤—ã–π –∫–ª–∏–∫ –Ω–∞ index.html ‚Üí Open with Live Server

4. ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞ CORS:
   - –ë—Ä–∞—É–∑–µ—Ä –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–≥—Ä—É–∑–∫—É —Ä–µ—Å—É—Ä—Å–æ–≤ —á–µ—Ä–µ–∑ file://
   - –ù—É–∂–µ–Ω HTTP —Å–µ—Ä–≤–µ—Ä (localhost:8000)`);
        }

        function openLocalServer() {
            window.open('local_server.html', '_blank');
        }

        function downloadPython() {
            window.open('https://www.python.org/downloads/', '_blank');
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–æ–ø—ã—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('load', () => {
            setTimeout(() => {
                if (!gameLoaded) {
                    console.log('–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–æ–ø—ã—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–≥—Ä—ã...');
                    tryLoadGame();
                }
            }, 1000);
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
        window.addEventListener('error', (event) => {
            console.error('–ì–ª–æ–±–∞–ª—å–Ω–∞—è –æ—à–∏–±–∫–∞:', event.error);
            if (!gameLoaded) {
                showFallbackMessage();
            }
        });
    </script>
</body>
</html>
